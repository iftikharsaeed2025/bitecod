{"version":3,"file":"vue-handsontable.js","sources":["../src/helpers.ts","../src/HotTable.vue","../src/HotTable.vue?vue&type=template&id=54bcc3fa&lang.js","../src/HotColumn.vue"],"sourcesContent":["import Handsontable from 'handsontable/base';\nimport { HotTableProps, VueProps } from './types';\n\nconst unassignedPropSymbol = Symbol('unassigned');\n\n/**\n * Message for the warning thrown if the Handsontable instance has been destroyed.\n */\nexport const HOT_DESTROYED_WARNING = 'The Handsontable instance bound to this component was destroyed and cannot be' +\n  ' used properly.';\n\n/**\n * Check if at specified `key` there is any value for `object`.\n *\n * @param {object} object Object to search value at specyfic key.\n * @param {string} key String key to check.\n * @returns {boolean}\n */\nexport function hasOwnProperty(object: unknown, key: string): boolean {\n  return Object.prototype.hasOwnProperty.call(object, key);\n}\n\n/**\n * Generate an object containing all the available Handsontable properties and plugin hooks.\n *\n * @param {string} source Source for the factory (either 'HotTable' or 'HotColumn').\n * @returns {object}\n */\nexport function propFactory(source: 'HotTable' | 'HotColumn'): VueProps<HotTableProps> {\n  const registeredHooks = Handsontable.hooks.getRegistered();\n  const propSchema: VueProps<HotTableProps> = {};\n\n  Object.assign(propSchema, Handsontable.DefaultSettings);\n\n  // eslint-disable-next-line no-restricted-syntax, guard-for-in\n  for (const prop in propSchema) {\n    propSchema[prop] = {\n      default: unassignedPropSymbol\n    };\n  }\n\n  for (let i = 0; i < registeredHooks.length; i++) {\n    propSchema[registeredHooks[i]] = {\n      default: unassignedPropSymbol\n    };\n  }\n\n  propSchema.settings = {\n    default: unassignedPropSymbol\n  };\n\n  if (source === 'HotTable') {\n    propSchema.id = {\n      type: String,\n      default: `hot-${Math.random().toString(36).substring(5)}`\n    };\n  }\n\n  return propSchema;\n}\n\n/**\n * Filter out all of the unassigned props, and return only the one passed to the component.\n *\n * @param {object} props Object containing all the possible props.\n * @returns {object} Object containing only used props.\n */\nexport function filterPassedProps(props) {\n  const filteredProps: VueProps<HotTableProps> = {};\n  const columnSettingsProp = props.settings;\n\n  if (columnSettingsProp !== unassignedPropSymbol) {\n    // eslint-disable-next-line no-restricted-syntax\n    for (const propName in columnSettingsProp) {\n      if (hasOwnProperty(columnSettingsProp, propName) && columnSettingsProp[propName] !== unassignedPropSymbol) {\n        filteredProps[propName] = columnSettingsProp[propName];\n      }\n    }\n  }\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const propName in props) {\n    if (hasOwnProperty(props, propName) && propName !== 'settings' && props[propName] !== unassignedPropSymbol) {\n      filteredProps[propName] = props[propName];\n    }\n  }\n\n  return filteredProps;\n}\n\n/**\n * Prepare the settings object to be used as the settings for Handsontable, based on the props provided to the component.\n *\n * @param {HotTableProps} props The props passed to the component.\n * @param {Handsontable.GridSettings} currentSettings The current Handsontable settings.\n * @returns {Handsontable.GridSettings} An object containing the properties, ready to be used within Handsontable.\n */\nexport function prepareSettings(props: HotTableProps, currentSettings?: Handsontable.GridSettings): HotTableProps {\n  const assignedProps: VueProps<HotTableProps> = filterPassedProps(props);\n  const hotSettingsInProps: Handsontable.GridSettings = props.settings ? props.settings : assignedProps;\n  const additionalHotSettingsInProps: Handsontable.GridSettings = props.settings ? assignedProps : null;\n  const newSettings: Handsontable.GridSettings = {};\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const key in hotSettingsInProps) {\n    if (\n      hasOwnProperty(hotSettingsInProps, key) &&\n      hotSettingsInProps[key] !== void 0 &&\n      ((currentSettings && key !== 'data') ? !simpleEqual(currentSettings[key], hotSettingsInProps[key]) : true)\n    ) {\n      newSettings[key] = hotSettingsInProps[key];\n    }\n  }\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const key in additionalHotSettingsInProps) {\n    if (\n      hasOwnProperty(additionalHotSettingsInProps, key) &&\n      key !== 'id' &&\n      key !== 'settings' &&\n      additionalHotSettingsInProps[key] !== void 0 &&\n      ((currentSettings && key !== 'data')\n        ? !simpleEqual(currentSettings[key], additionalHotSettingsInProps[key]) : true)\n    ) {\n      newSettings[key] = additionalHotSettingsInProps[key];\n    }\n  }\n\n  return newSettings;\n}\n\n/**\n * Compare two objects using `JSON.stringify`.\n * *Note: * As it's using the stringify function to compare objects, the property order in both objects is\n * important. It will return `false` for the same objects, if they're defined in a different order.\n *\n * @param {object} objectA First object to compare.\n * @param {object} objectB Second object to compare.\n * @returns {boolean} `true` if they're the same, `false` otherwise.\n */\nfunction simpleEqual(objectA, objectB) {\n  const stringifyToJSON = (val) => {\n    const circularReplacer = (function() {\n      const seen = new WeakSet();\n\n      return function(key, value) {\n        if (typeof value === 'object' && value !== null) {\n          if (seen.has(value)) {\n            return;\n          }\n\n          seen.add(value);\n        }\n\n        return value;\n      };\n    }());\n\n    return JSON.stringify(val, circularReplacer);\n  };\n\n  if (typeof objectA === 'function' && typeof objectB === 'function') {\n    return objectA.toString() === objectB.toString();\n\n  } else if (typeof objectA !== typeof objectB) {\n    return false;\n\n  } else {\n    return stringifyToJSON(objectA) === stringifyToJSON(objectB);\n  }\n}\n","<template>\n  <div :id=\"id\">\n    <slot></slot>\n  </div>\n</template>\n\n<script lang=\"ts\">\n// eslint-disable-next-line  @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport { defineComponent, VNode, markRaw } from 'vue';\n// TODO: The line above is ts-ignored because rollup-plugin-typescript2 throws an error otherwise.\n// It's most probably caused by outdated rollup-plugin-vue which is no longer maintained.\n\nimport Handsontable from 'handsontable/base';\nimport {\n  HOT_DESTROYED_WARNING,\n  prepareSettings,\n  propFactory,\n} from './helpers';\nimport {\n  HotTableProps,\n} from './types';\nimport * as packageJson from '../package.json';\n\nconst HotTable = defineComponent({\n  name: 'HotTable',\n  props: propFactory('HotTable'),\n  provide() {\n    return {\n      columnsCache: this.columnsCache\n    };\n  },\n  watch: {\n    $props: {\n      handler(props) {\n        const settings = prepareSettings(props, this.hotInstance ? this.hotInstance.getSettings() : void 0);\n\n        if (!this.hotInstance || settings === void 0) {\n          return;\n        }\n\n        if (settings.data) {\n          if (\n            this.hotInstance.isColumnModificationAllowed() ||\n            (\n              !this.hotInstance.isColumnModificationAllowed() &&\n              this.hotInstance.countSourceCols() === this.miscCache.currentSourceColumns\n            )\n          ) {\n            // If the dataset dimensions change, update the index mappers.\n            this.matchHotMappersSize();\n\n            // Data is automatically synchronized by reference.\n            delete settings.data;\n          }\n        }\n\n        // If there are another options changed, update the HOT settings, render the table otherwise.\n        if (Object.keys(settings).length) {\n          this.hotInstance.updateSettings(settings);\n\n        } else {\n          this.hotInstance.render();\n        }\n\n        this.miscCache.currentSourceColumns = this.hotInstance.countSourceCols();\n      },\n      deep: true,\n      immediate: true,\n    },\n  },\n  data() {\n    return {\n      /* eslint-disable vue/no-reserved-keys */\n      __hotInstance: null as Handsontable,\n      /* eslint-enable vue/no-reserved-keys */\n      miscCache: {\n        currentSourceColumns: null,\n      },\n      columnSettings: null as HotTableProps[],\n      columnsCache: new Map<VNode, HotTableProps>(),\n      get hotInstance(): Handsontable | null {\n        if (!this.__hotInstance || (this.__hotInstance && !this.__hotInstance.isDestroyed)) {\n\n          // Will return the Handsontable instance or `null` if it's not yet been created.\n          return this.__hotInstance;\n\n        } else {\n          /* eslint-disable-next-line no-console */\n          console.warn(HOT_DESTROYED_WARNING);\n\n          return null;\n        }\n      },\n      set hotInstance(hotInstance: Handsontable) {\n        this.__hotInstance = hotInstance;\n      },\n    };\n  },\n  methods: {\n    /**\n     * Initialize Handsontable.\n     */\n    hotInit() {\n      const newSettings = prepareSettings(this.$props);\n\n      newSettings.columns = this.columnSettings ? this.columnSettings : newSettings.columns;\n\n      this.hotInstance = markRaw<Handsontable>(new Handsontable.Core(this.$el, newSettings));\n      this.hotInstance.init();\n\n      this.miscCache.currentSourceColumns = this.hotInstance.countSourceCols();\n    },\n\n    matchHotMappersSize(): void {\n      if (!this.hotInstance) {\n        return;\n      }\n\n      const data: Handsontable.CellValue[][] = this.hotInstance.getSourceData();\n      const rowsToRemove: number[] = [];\n      const columnsToRemove: number[] = [];\n      const indexMapperRowCount = this.hotInstance.rowIndexMapper.getNumberOfIndexes();\n      const isColumnModificationAllowed = this.hotInstance.isColumnModificationAllowed();\n      let indexMapperColumnCount = 0;\n\n      if (data && data.length !== indexMapperRowCount) {\n        if (data.length < indexMapperRowCount) {\n          for (let r = data.length; r < indexMapperRowCount; r++) {\n            rowsToRemove.push(r);\n          }\n        }\n      }\n\n      if (isColumnModificationAllowed) {\n        indexMapperColumnCount = this.hotInstance.columnIndexMapper.getNumberOfIndexes();\n\n        if (data && data[0] && data[0]?.length !== indexMapperColumnCount) {\n          if (data[0].length < indexMapperColumnCount) {\n            for (let c = data[0].length; c < indexMapperColumnCount; c++) {\n              columnsToRemove.push(c);\n            }\n          }\n        }\n      }\n\n      this.hotInstance.batch(() => {\n        if (rowsToRemove.length > 0) {\n          this.hotInstance.rowIndexMapper.removeIndexes(rowsToRemove);\n\n        } else {\n          this.hotInstance.rowIndexMapper\n            .insertIndexes(indexMapperRowCount - 1, data.length - indexMapperRowCount);\n        }\n\n        if (isColumnModificationAllowed && data.length !== 0) {\n          if (columnsToRemove.length > 0) {\n            this.hotInstance.columnIndexMapper.removeIndexes(columnsToRemove);\n\n          } else {\n            this.hotInstance.columnIndexMapper\n              .insertIndexes(indexMapperColumnCount - 1, data[0].length - indexMapperColumnCount);\n          }\n        }\n      });\n    },\n\n    /**\n     * Get settings for the columns provided in the `hot-column` components.\n     *\n     * @returns {HotTableProps[] | undefined}\n     */\n    getColumnSettings(): HotTableProps[] | void {\n      const columnSettings: HotTableProps[] = Array.from(this.columnsCache.values());\n\n      return columnSettings.length ? columnSettings : void 0;\n    },\n  },\n  mounted() {\n    this.columnSettings = this.getColumnSettings();\n    this.hotInit();\n  },\n  beforeUnmount() {\n    if (this.hotInstance) {\n      this.hotInstance.destroy();\n    }\n  },\n  version: (packageJson as unknown as { version: string }).version,\n});\n\nexport default HotTable;\nexport { HotTable };\n</script>\n","<template>\n  <div :id=\"id\">\n    <slot></slot>\n  </div>\n</template>\n\n<script lang=\"ts\">\n// eslint-disable-next-line  @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport { defineComponent, VNode, markRaw } from 'vue';\n// TODO: The line above is ts-ignored because rollup-plugin-typescript2 throws an error otherwise.\n// It's most probably caused by outdated rollup-plugin-vue which is no longer maintained.\n\nimport Handsontable from 'handsontable/base';\nimport {\n  HOT_DESTROYED_WARNING,\n  prepareSettings,\n  propFactory,\n} from './helpers';\nimport {\n  HotTableProps,\n} from './types';\nimport * as packageJson from '../package.json';\n\nconst HotTable = defineComponent({\n  name: 'HotTable',\n  props: propFactory('HotTable'),\n  provide() {\n    return {\n      columnsCache: this.columnsCache\n    };\n  },\n  watch: {\n    $props: {\n      handler(props) {\n        const settings = prepareSettings(props, this.hotInstance ? this.hotInstance.getSettings() : void 0);\n\n        if (!this.hotInstance || settings === void 0) {\n          return;\n        }\n\n        if (settings.data) {\n          if (\n            this.hotInstance.isColumnModificationAllowed() ||\n            (\n              !this.hotInstance.isColumnModificationAllowed() &&\n              this.hotInstance.countSourceCols() === this.miscCache.currentSourceColumns\n            )\n          ) {\n            // If the dataset dimensions change, update the index mappers.\n            this.matchHotMappersSize();\n\n            // Data is automatically synchronized by reference.\n            delete settings.data;\n          }\n        }\n\n        // If there are another options changed, update the HOT settings, render the table otherwise.\n        if (Object.keys(settings).length) {\n          this.hotInstance.updateSettings(settings);\n\n        } else {\n          this.hotInstance.render();\n        }\n\n        this.miscCache.currentSourceColumns = this.hotInstance.countSourceCols();\n      },\n      deep: true,\n      immediate: true,\n    },\n  },\n  data() {\n    return {\n      /* eslint-disable vue/no-reserved-keys */\n      __hotInstance: null as Handsontable,\n      /* eslint-enable vue/no-reserved-keys */\n      miscCache: {\n        currentSourceColumns: null,\n      },\n      columnSettings: null as HotTableProps[],\n      columnsCache: new Map<VNode, HotTableProps>(),\n      get hotInstance(): Handsontable | null {\n        if (!this.__hotInstance || (this.__hotInstance && !this.__hotInstance.isDestroyed)) {\n\n          // Will return the Handsontable instance or `null` if it's not yet been created.\n          return this.__hotInstance;\n\n        } else {\n          /* eslint-disable-next-line no-console */\n          console.warn(HOT_DESTROYED_WARNING);\n\n          return null;\n        }\n      },\n      set hotInstance(hotInstance: Handsontable) {\n        this.__hotInstance = hotInstance;\n      },\n    };\n  },\n  methods: {\n    /**\n     * Initialize Handsontable.\n     */\n    hotInit() {\n      const newSettings = prepareSettings(this.$props);\n\n      newSettings.columns = this.columnSettings ? this.columnSettings : newSettings.columns;\n\n      this.hotInstance = markRaw<Handsontable>(new Handsontable.Core(this.$el, newSettings));\n      this.hotInstance.init();\n\n      this.miscCache.currentSourceColumns = this.hotInstance.countSourceCols();\n    },\n\n    matchHotMappersSize(): void {\n      if (!this.hotInstance) {\n        return;\n      }\n\n      const data: Handsontable.CellValue[][] = this.hotInstance.getSourceData();\n      const rowsToRemove: number[] = [];\n      const columnsToRemove: number[] = [];\n      const indexMapperRowCount = this.hotInstance.rowIndexMapper.getNumberOfIndexes();\n      const isColumnModificationAllowed = this.hotInstance.isColumnModificationAllowed();\n      let indexMapperColumnCount = 0;\n\n      if (data && data.length !== indexMapperRowCount) {\n        if (data.length < indexMapperRowCount) {\n          for (let r = data.length; r < indexMapperRowCount; r++) {\n            rowsToRemove.push(r);\n          }\n        }\n      }\n\n      if (isColumnModificationAllowed) {\n        indexMapperColumnCount = this.hotInstance.columnIndexMapper.getNumberOfIndexes();\n\n        if (data && data[0] && data[0]?.length !== indexMapperColumnCount) {\n          if (data[0].length < indexMapperColumnCount) {\n            for (let c = data[0].length; c < indexMapperColumnCount; c++) {\n              columnsToRemove.push(c);\n            }\n          }\n        }\n      }\n\n      this.hotInstance.batch(() => {\n        if (rowsToRemove.length > 0) {\n          this.hotInstance.rowIndexMapper.removeIndexes(rowsToRemove);\n\n        } else {\n          this.hotInstance.rowIndexMapper\n            .insertIndexes(indexMapperRowCount - 1, data.length - indexMapperRowCount);\n        }\n\n        if (isColumnModificationAllowed && data.length !== 0) {\n          if (columnsToRemove.length > 0) {\n            this.hotInstance.columnIndexMapper.removeIndexes(columnsToRemove);\n\n          } else {\n            this.hotInstance.columnIndexMapper\n              .insertIndexes(indexMapperColumnCount - 1, data[0].length - indexMapperColumnCount);\n          }\n        }\n      });\n    },\n\n    /**\n     * Get settings for the columns provided in the `hot-column` components.\n     *\n     * @returns {HotTableProps[] | undefined}\n     */\n    getColumnSettings(): HotTableProps[] | void {\n      const columnSettings: HotTableProps[] = Array.from(this.columnsCache.values());\n\n      return columnSettings.length ? columnSettings : void 0;\n    },\n  },\n  mounted() {\n    this.columnSettings = this.getColumnSettings();\n    this.hotInit();\n  },\n  beforeUnmount() {\n    if (this.hotInstance) {\n      this.hotInstance.destroy();\n    }\n  },\n  version: (packageJson as unknown as { version: string }).version,\n});\n\nexport default HotTable;\nexport { HotTable };\n</script>\n","<script lang=\"ts\">\n// eslint-disable-next-line  @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport { defineComponent } from 'vue';\n// TODO: The line above is ts-ignored because rollup-plugin-typescript2 throws an error otherwise.\n// It's most probably caused by outdated rollup-plugin-vue which is no longer maintained.\n\nimport {\n  propFactory,\n  filterPassedProps\n} from './helpers';\n\nconst HotColumn = defineComponent({\n  name: 'HotColumn',\n  props: propFactory('HotColumn'),\n  inject: ['columnsCache'],\n  methods: {\n    /**\n     * Create the column settings based on the data provided to the `hot-column`\n     * component and it's child components.\n     */\n    createColumnSettings(): void {\n      const assignedProps = filterPassedProps(this.$props);\n      const columnSettings = { ...assignedProps };\n\n      if (assignedProps.renderer) {\n        columnSettings.renderer = assignedProps.renderer;\n      }\n\n      if (assignedProps.editor) {\n        columnSettings.editor = assignedProps.editor;\n      }\n\n      this.columnsCache.set(this, columnSettings);\n    }\n  },\n  mounted() {\n    this.createColumnSettings();\n  },\n  unmounted() {\n    this.columnsCache.delete(this);\n  },\n  render() {\n    return null;\n  }\n});\n\nexport default HotColumn;\nexport { HotColumn };\n</script>\n"],"names":["unassignedPropSymbol","Symbol","HOT_DESTROYED_WARNING","hasOwnProperty","object","key","Object","prototype","call","propFactory","source","registeredHooks","Handsontable","hooks","getRegistered","propSchema","assign","DefaultSettings","prop","i","length","settings","id","type","String","concat","Math","random","toString","substring","filterPassedProps","props","filteredProps","columnSettingsProp","propName","prepareSettings","currentSettings","assignedProps","hotSettingsInProps","additionalHotSettingsInProps","newSettings","simpleEqual","objectA","objectB","stringifyToJSON","val","circularReplacer","seen","WeakSet","value","_typeof","has","add","JSON","stringify","HotTable","defineComponent","name","provide","columnsCache","watch","$props","handler","hotInstance","getSettings","data","isColumnModificationAllowed","countSourceCols","miscCache","currentSourceColumns","matchHotMappersSize","keys","updateSettings","render","deep","immediate","__hotInstance","columnSettings","Map","isDestroyed","console","warn","methods","hotInit","columns","markRaw","Core","$el","init","_this","getSourceData","rowsToRemove","columnsToRemove","indexMapperRowCount","rowIndexMapper","getNumberOfIndexes","indexMapperColumnCount","r","push","_data$","columnIndexMapper","c","batch","removeIndexes","insertIndexes","getColumnSettings","Array","from","values","mounted","beforeUnmount","destroy","version","packageJson","_createElementBlock","_ctx","_renderSlot","$slots","HotColumn","inject","createColumnSettings","_objectSpread","renderer","editor","set","unmounted"],"mappings":"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"}